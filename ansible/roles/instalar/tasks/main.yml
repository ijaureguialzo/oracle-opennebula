- name: Instalar el paquete de preinstalación
  ansible.builtin.dnf:
    name: oracle-database-preinstall-21c
    state: latest

- name: Instalar el paquete principal
  ansible.builtin.dnf:
    name: "/tmp/{{ ORACLE_RPM_FILENAME }}"
    state: present

- name: Definir la IP real en el fichero de hosts
  ansible.builtin.replace:
    path: /etc/hosts
    regexp: '127\.0\.0\.1 oracle\-opennebula'
    replace: '{{ ansible_eth0.ipv4.address }} oracle\-opennebula'

- name: Lanzar el script de configuración
  ansible.builtin.shell: /etc/init.d/oracledb_ORCLCDB-21c configure
  ignore_errors: true
